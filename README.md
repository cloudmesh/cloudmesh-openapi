# Cloudmesh OpenAPI Merge


[![image](https://img.shields.io/travis/TankerHQ/cloudmesh-openapi.svg?branch=master)](https://travis-ci.org/TankerHQ/cloudmesn-openapi)

[![image](https://img.shields.io/pypi/pyversions/cloudmesh-openapi.svg)](https://pypi.org/project/cloudmesh-openapi)

[![image](https://img.shields.io/pypi/v/cloudmesh-openapi.svg)](https://pypi.org/project/cloudmesh-openapi/)

[![image](https://img.shields.io/github/license/TankerHQ/python-cloudmesh-openapi.svg)](https://github.com/TankerHQ/python-cloudmesh-openapi/blob/master/LICENSE)

## Prerequisits

```bash
$ pip install cloudmesh.openapi
```

## Overview



## Install

Make sure that cloudmesh is properly installed on your machine and you have mongodb setup to work with cloudmesh.

You can install the openapi function individually from the full cloudmesh suite by running:

`cloudmesh-installer get openapi`

## Usage

When getting started using the `openapi3`, please first call `cms help openapi3` to see the available functions 
and options.

After that the first step is to find an Open Api 3 compliant spec that you are comfortable using or to create one 
yourself. If you are not familiar with Open API specs, it is suggested to go read up on those before using this command.

Create a YAML file in your project directory for the Open Api specification

Here is an example spec that can be used:

```yaml
openapi: 3.0.0
info:
  title: cpu
  description: A simple service to get cpuinfo as an example of using OpenAPI 3.0
  license:
    name: Apache 2.0
  version: 0.0.1

servers:
  - url: http://localhost:8080/cloudmesh

paths:
  /cpu:
    get:
      summary: Returns cpu information of the hosting server
      operationId: cpu.get_processor_name
      responses:
        '200':
          description: cpu info
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/cpu"

components:
  schemas:
    cpu:
      type: "object"
      required:
        - "model"
      properties:
        model:
          type: "string"
```

For this spec to work it is necessary to also create a function called `get_processor_name` in a cpu.py file in the same 
directory. Once that has been saved you have all the parts to now spin up you API using cloudmesh.

Take not of the working directory name where you store the YAML and python files. To start a server to host this API
you must run the `server start` function and pass in the relative, or absolute, location of the API specification as a parameter.

`cms openapi3 server start ./cpu.yaml`

This will output the serer name, PID, URL, and spec location to the terminal.

Verify that your server has successfully spun up by running `ps` and look for the PID value in the list. If it is not 
in the list the server did not start correctly. 

You can also ping the returned URL to see if you get a successful response. 

### Generating API Endpoints

The openapi3 command can also generate Open API specs from python functions using `cms openapi3 generate`.
Once you have generated an API spec using cloudmesh follow through the same process as above except with your newly 
generated endpoint to make the API accessible.

The data returned from a generated endpoint is returned in JSON format.

### Endpoint Registry

A mongodb registry allows you to store information about started servers and API endpoints generated by the openapi3 
command. You can use a tool like Robo 3T to add a GUI to view the contents of the database to verify that your interactions
with the database are working. 

There are add, delete, rename, and list functions for the registry command.

`cms openapi3 register`

### Stopping Servers

When it is necessary to stop a server hosting an endpoint generated or start using cloudmesh use the stop command and
 passing the name of the server as a parameter.
In the context of the earlier example the command is:

`cms openapi3 server stop cpu` 


## Pytests

How to run them 

TBD

## Examples

TBD

??????

### One function in function.py

cms openapi3 generate function.py -> function.yaml


Bugs: docstring is not yet in the yaml from the function

function.py

```
def a(x:int, y:int):
return 1
```

### Multiple functions in function.py

 
cms openapi3 generate function.py [--names=a,c] -> function.yaml
 #dont include b

cms openapi3 generate function.py -> function.yaml

function.py

functions = list all functions in file

```
def a(x:int, y:int):
	r = b(x,y)
	return 3

def b(x:int, y:int):
	return 1

def c(x:int, y:int):
	return 1
```

### Uploading data

Always the same
so we can preimplement

abc.txt -> /data/xyz/klmn.txt

### Downloading data

Always the same

abc.txt <- /data/xyz/klmn.txt

### Merge openapi's

merge [APIS...] - > single.yaml


### Google

* Andrew

### AWS

* Jonathan

### Azure

* Andrew

### Openstack

* Jagadesh (cloudmesh)



### Oracle

* Prateek




## sckit learn


--output=yaml
--output=function

generatie a function by hand, where is the documentation, where are
the links ???

This motivates doing it automatically.

def param(name, type, description):
	t1 = f":param {name}: {description}"
    t2 = f":type {type}"
	return t



spec -> function.py with typing -> generator -> yaml

spec -> yaml

cms generate --sckitlearn --name=abc --function="LinearRegression().fit" -> LinearRegression_fit.yaml

cms generate --sckitlearn --name=abc --function="LinearRegression().predict,LinearRegression().fit"  -> LinearRegression_abc.yaml

cms generate --sckitlearn --class="LinearRegression"  -> LinearRegression.yaml

	* integrate all methods in the class



## OLD DOCUMENTATION DO NOT MDDIFY






## Usage

The manual page for the `cms openapi` command  is

```
cms openapi merge [SERVICES...] [--dir=DIR]
cms openapi list [--dir=DIR]
cms openapi description [SERVICES...] [--dir=DIR]
cms openapi md FILE [--indent=INDENT]
```


You need to have the yaml file in the current directory and execute
this program in this directory

An example for yaml files are provided in 

* <https://github.com/cloudmesh-community/nist/tree/master/spec>

Please note that the spec directory is containing openapi specifications that
may not yet completed or are actively worked on. You are invited to participate.
You can download some examples, as well as the `.header.yaml` file you will need
with for example curl

Once you have `organization.yaml`, `user.yaml` `timestap.yaml` and `.header
yaml` in your directory you can say

Please note that this script does not yet rewrite the `$ref`
appropriately, but if you like to help you can do so.

## Example use

Here we demonstrate an example use

First we download some OpenAPI examples:

```bash
mkdir example
cd example
$ export SPEC=https://raw.githubusercontent.com/cloudmesh-community/nist/master/spec
$ curl $SPEC/organization.yaml > organization.yaml
$ curl $SPEC/user.yaml > user.yaml
$ curl $SPEC/timestamp.yaml > timestamp.yaml
$ curl $SPEC/.header.yaml > .header.yaml

```

# Cloudmehs 


# OLD DOCUMENTATION

Now let us look at the descriptions with 

```bash
$ cms openapi description organization user timestamp
```

To create a merged specification you can use 

```bash
$ cms openapi merge organization user timestamp
```

To create a markdown representation you can use 

```bash
$ cms openapi md user
```

Note that for the markdown specification only one service is specified.



