# Cloudmesh OpenAPI Merge

{icons}

> **Note:** The README.md page is outomatically generated, do not edit it.
> To modify  change the content in
> <https://github.com/cloudmesh/cloudmesh-openapi/blob/master/README-source.md>
> and use `bin/readme.py`. This note will be moved to the end of this document
> at a later stage in the project, till everyone knows about it.
>  The source uses {{ }} for using text in single brackets

## Prerequisits

* We use recommend Python 3.8.2 Python or newer.
* We recommend pip version 20.0.2 or newer
* We recommend that you use a venv (see developer install)
* MongoDB installed as regular program not as service

We have not checked if it works on older versions.

## Instalation

Make sure that cloudmesh is properly installed on your machine and you
have mongodb setup to work with cloudmesh.

More details to setting up mongo can be found in the

* [Cloudmesh Manual](https://cloudmesh.github.io/cloudmesh-manual/installation/install.html)

###  User Instalation

Make sure you use a python venv before installing. Users can install the
code with

```bash
$ pip install cloudmesh-openapi
```


### Developere Instalation

Developers install also the source code

```
python -m venv ~/ENV3
source ~/ENV3/bin/activate # on windows ENV3\Scripts\activate
mkdir cm
cd cm
pip install cloudmesh-installer
cloudmesh-installer get openapi 
```

## Overview

When getting started using the `openapi`, please first call `cms help
openapi` to see the available functions and options. For your
convenience we include the manual page later on in this documenth.

## Usage

After that the first step is to find an Open Api 3 compliant spec that
you are comfortable using or to create one yourself. If you are not
familiar with Open API specs, it is suggested to go read up on those
before using this command.

Create a YAML file in your project directory for the Open Api
specification

Here is an example spec that can be used:

```yaml
openapi: 3.0.0
info:
  title: cpu
  description: A simple service to get cpuinfo as an example of using OpenAPI 3.0
  license:
    name: Apache 2.0
  version: 0.0.1

servers:
  - url: http://localhost:8080/cloudmesh

paths:
  /cpu:
    get:
      summary: Returns cpu information of the hosting server
      operationId: cpu.get_processor_name
      responses:
        '200':
          description: cpu info
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/cpu"

components:
  schemas:
    cpu:
      type: "object"
      required:
        - "model"
      properties:
        model:
          type: "string"
```

For this spec to work it is necessary to also create a function called
`get_processor_name` in a cpu.py file in the same directory. Once that
has been saved you have all the parts to now spin up you API using
cloudmesh.

Take not of the working directory name where you store the YAML and
python files. To start a server to host this API you must run the
`server start` function and pass in the relative, or absolute, location
of the API specification as a parameter.

`cms openapi server start ./cpu.yaml`

This will output the serer name, PID, URL, and spec location to the
terminal.

Verify that your server has successfully spun up by running `ps` and
look for the PID value in the list. If it is not in the list the server
did not start correctly.

You can also ping the returned URL to see if you get a successful
response.

### Generating API Endpoints

The openapi command can also generate Open API specs from python
functions using `cms openapi generate`. Once you have generated an API
spec using cloudmesh follow through the same process as above except
with your newly generated endpoint to make the API accessible.

The data returned from a generated endpoint is returned in JSON format.

### Endpoint Registry

A mongodb registry allows you to store information about started servers
and API endpoints generated by the openapi command. You can use a tool
like Robo 3T to add a GUI to view the contents of the database to verify
that your interactions with the database are working.

There are add, delete, rename, and list functions for the registry command.

`cms openapi register`

### Stopping Servers

When it is necessary to stop a server hosting an endpoint generated or
start using cloudmesh use the stop command and passing the name of the
server as a parameter. In the context of the earlier example the command
is:

`cms openapi server stop cpu`

## Manual

{manual}


## Pytests

TODO: How to run them

{tests}

## Examples

TBD

??????

### One function in function.py

cms openapi generate function.py -> function.yaml


Bugs: docstring is not yet in the yaml from the function

function.py

```
def a(x:int, y:int):
return 1
```

### Multiple functions in function.py

```
cms openapi generate function.py [--names=a,c] -> function.yaml
 #dont include b
```

cms openapi generate function.py -> function.yaml

function.py

functions = list all functions in file

```
def a(x:int, y:int):
	r = b(x,y)
	return 3

def b(x:int, y:int):
	return 1

def c(x:int, y:int):
	return 1
```

### Uploading data

Always the same
so we can preimplement

abc.txt -> /data/xyz/klmn.txt

### Downloading data

Always the same

abc.txt <- /data/xyz/klmn.txt

### Merge openapi's

```
merge [APIS...] - > single.yaml
```

### Google

* Andrew

### AWS

* Jonathan

### Azure

* Andrew

### Openstack

* Jagadesh (cloudmesh)



### Oracle

* Prateek




## sckit learn

```
--output=yaml
--output=function

generatie a function by hand, where is the documentation, where are
the links ???

This motivates doing it automatically.

def param(name, type, description):
	t1 = f":param {{name}}: {{description}}"
    t2 = f":type {{type}}"
	return t



spec -> function.py with typing -> generator -> yaml

spec -> yaml

cms generate --sckitlearn --name=abc --function="LinearRegression().fit" -> LinearRegression_fit.yaml

cms generate --sckitlearn --name=abc --function="LinearRegression().predict,LinearRegression().fit"  -> LinearRegression_abc.yaml

cms generate --sckitlearn --class="LinearRegression"  -> LinearRegression.yaml

	* integrate all methods in the class
```

